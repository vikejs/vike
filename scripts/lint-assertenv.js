#!/usr/bin/env node

/**
 * Linting script to ensure all .ts files have an assertEnv*.ts import.
 *
 * This script checks that all TypeScript files in packages/vike/src import
 * the appropriate assertEnv*.ts file, with a whitelist for files that are
 * currently exempt from this requirement.
 */

const fs = require('node:fs')
const path = require('node:path')
const { execSync } = require('node:child_process')

// Whitelist of .ts files that currently don't import assertEnv*.ts
const WHITELIST = [
  'packages/vike/src/client/runtime-client-routing/prefetch/PrefetchSetting.ts',
  'packages/vike/src/client/runtime-client-routing/prefetch.ts',
  'packages/vike/src/client/runtime-client-routing/prerender.ts',
  'packages/vike/src/client/runtime-client-routing/useClientRouter.ts',
  'packages/vike/src/client/runtime-client-routing/utils.ts',
  'packages/vike/src/client/runtime-client-routing/getPageId.ts',
  'packages/vike/src/client/runtime-client-routing/onLinkClick.ts',
  'packages/vike/src/client/runtime-client-routing/history.ts',
  'packages/vike/src/client/runtime-client-routing/pageFiles.ts',
  'packages/vike/src/client/runtime-client-routing/navigation.ts',
  'packages/vike/src/client/runtime-page-setup/renderPageClientSide.ts',
  'packages/vike/src/client/runtime-page-setup/preparePageContext.ts',
  'packages/vike/src/client/runtime-page-setup/getPageContext.ts',
  'packages/vike/src/client/runtime-page-setup/index.ts',
  'packages/vike/src/client/runtime-page-setup/getPageFilesClientSide.ts',
  'packages/vike/src/client/buildRelease/checkVikeVersion.ts',
  'packages/vike/src/client/buildRelease/onRenderClient.ts',
  'packages/vike/src/client/buildRelease/releasePageContextCommon.ts',
  'packages/vike/src/client/buildRelease/releasePageContext.ts',
  'packages/vike/src/node/createDevMiddleware.ts',
  'packages/vike/src/node/api/types.ts',
  'packages/vike/src/node/prerender/resolvePrerenderConfig.ts',
  'packages/vike/src/node/prerender/context.ts',
  'packages/vike/src/node/prerender/runPrerenderEntry.ts',
  'packages/vike/src/node/prerender/index.ts',
  'packages/vike/src/node/prerender/runPrerender.ts',
  'packages/vike/src/node/cli/dist.ts',
  'packages/vike/src/node/cli/index.ts',
  'packages/vike/src/node/cli/loader/css/index.ts',
  'packages/vike/src/node/cli/loader/css/cssTransform.ts',
  'packages/vike/src/node/cli/loader/esbuild/index.ts',
  'packages/vike/src/node/cli/loader/esbuild/loader.ts',
  'packages/vike/src/node/cli/loader/html/transformHtml.ts',
  'packages/vike/src/node/cli/loader/html/index.ts',
  'packages/vike/src/node/cli/loader/transformPageFilesWithVite.ts',
  'packages/vike/src/node/api/index.ts',
  'packages/vike/src/node/api/api.ts',
  'packages/vike/src/node/api/fetchPageFilesClientSide.ts',
  'packages/vike/src/node/api/injectPageFilesRollupInput.ts',
  'packages/vike/src/node/vite/index.ts',
  'packages/vike/src/node/vite/onServerEntry.ts',
  'packages/vike/src/node/vite/manifest/searchManifest.ts',
  'packages/vike/src/node/vite/manifest/retrieveDevServer.ts',
  'packages/vike/src/node/vite/manifest/parseManifest.ts',
  'packages/vike/src/node/vite/manifest/retrieveManifest.ts',
  'packages/vike/src/node/vite/manifest/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/autoImportWrappers/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/autoImportWrappers/getVirtualFileImportWrapperCode.ts',
  'packages/vike/src/node/vite/plugin/plugins/buildConfig.ts',
  'packages/vike/src/node/vite/plugin/plugins/baseUrls/removeAssetUrlFallbackInlineCode.ts',
  'packages/vike/src/node/vite/plugin/plugins/baseUrls/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/baseUrls/removeAssetUrlFallbackInlineCode/removeAssetUrlFallbackInlineCode.ts',
  'packages/vike/src/node/vite/plugin/plugins/baseUrls/removeAssetUrlFallbackInlineCode/extractAssetsAddQuery.ts',
  'packages/vike/src/node/vite/plugin/plugins/baseUrls/baseUrls.ts',
  'packages/vike/src/node/vite/plugin/plugins/commonConfig.ts',
  'packages/vike/src/node/vite/plugin/plugins/devConfig/determineFsAllowList.ts',
  'packages/vike/src/node/vite/plugin/plugins/devConfig/fixServerOpen.ts',
  'packages/vike/src/node/vite/plugin/plugins/devConfig/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/distFileNames.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractAssets.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractStyles/assertClientEntryId.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractStyles/extractStyles.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractStyles/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractStyles/getConfigValueSourceFile.ts',
  'packages/vike/src/node/vite/plugin/plugins/extractStyles/loadStyles.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/getVikeConfig/getVikeConfig.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/getVikeConfig/transpileAndExecuteFile.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/getVikeConfig/resolveVikeConfig.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/getVikeConfig/removeVirtualFilesFromDevServer.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/getVikeConfig/filesEnv.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/generateEagerImport.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/generateImportGlobs.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/generateGlobFileServer.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/generateGlobFileClient.ts',
  'packages/vike/src/node/vite/plugin/plugins/generateImportGlobs/generateImportGlobsEntriesEager.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/assertPlugin.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/filesClient.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/filesServer.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/getImportBuildCode.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/loadBuild.ts',
  'packages/vike/src/node/vite/plugin/plugins/importBuild/getConfigData.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/transformClientEntry.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/loadValueRuntime.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/v1-design/getVirtualFileIdPageConfigValuesAll.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/v1-design/getVikeClientEntry.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/v1-design/getConfigValue.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/v1-design/index.ts',
  'packages/vike/src/node/vite/plugin/plugins/importUserCode/v1-design/getConfigBuildTime.ts',
  'packages/vike/src/node/vite/plugin/plugins/manifest.ts',
  'packages/vike/src/node/vite/plugin/plugins/packageJsonFile.ts',
  'packages/vike/src/node/vite/plugin/plugins/resolveVikeConfig.ts',
  'packages/vike/src/node/vite/plugin/plugins/setGlobalContext.ts',
  'packages/vike/src/node/vite/plugin/plugins/suppressRollupWarning.ts',
  'packages/vike/src/node/vite/plugin/shared/getConfigVike.ts',
  'packages/vike/src/node/vite/plugin/shared/getGlobalContext.ts',
  'packages/vike/src/node/vite/plugin/shared/getPageContextTypeDefinitions.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/crawlPlusFiles.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/index.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/loadConfigFile.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/transpileAndExecuteFile.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/createPlusConfigFile.ts',
  'packages/vike/src/node/vite/plugin/shared/getVikeConfig/resolveVikeConfig.ts',
  'packages/vike/src/node/vite/plugin/shared/resolveVirtualFileId.ts',
  'packages/vike/src/node/vite/plugin/shared/findUserFiles.ts',
  'packages/vike/src/node/vite/plugin/shared/transpileAndExecuteCode.ts',
  'packages/vike/src/node/vite/plugin/shared/getConfigValueSource.ts',
  'packages/vike/src/node/vite/plugin/shared/getConfigValuesSerialized.ts',
  'packages/vike/src/node/vite/plugin/shared/injectHtmlTagsToString.ts',
  'packages/vike/src/node/vite/plugin/index.ts',
  'packages/vike/src/node/vite/plugin/helpers.ts',
  'packages/vike/src/shared-server-client/getPageContextRequestUrl.ts',
  'packages/vike/src/shared-server-client/getPageContextUrlComputed.ts',
  'packages/vike/src/shared-server-client/getPageFiles.ts',
  'packages/vike/src/shared-server-client/assertHookReturnedObject.ts',
  'packages/vike/src/shared-server-client/getPageContextPublicShared.ts',
  'packages/vike/src/shared-server-client/getGlobalContextPublicShared.ts',
  'packages/vike/src/shared-server-client/addIs404ToPageProps.ts',
  'packages/vike/src/shared-server-client/forkPageContext.ts',
  'packages/vike/src/shared-server-client/createPageContextShared.ts',
  'packages/vike/src/shared-server-client/determinePageIdOld.ts',
  'packages/vike/src/shared-server-client/assertPageContextProvidedByUser.ts',
  'packages/vike/src/shared-server-client/assertOnBeforeRenderHookReturn.ts',
  'packages/vike/src/shared-server-client/assertVirtualFileExports.ts',
  'packages/vike/src/shared-server-client/abort.ts',
  'packages/vike/src/shared-server-client/error-page.ts',
  'packages/vike/src/shared-server-client/createGlobalContextShared.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzeClientSide.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageClientSide.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageClientSide/analyzeExports.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageClientSide/ClientDependency.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageClientSide/determineClientEntry.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageClientSide/getExportNames.ts',
  'packages/vike/src/shared-server-client/getPageFiles/analyzePageServerSide.ts',
  'packages/vike/src/shared-server-client/getPageFiles/assert_exports_old_design.ts',
  'packages/vike/src/shared-server-client/getPageFiles/fileTypes.ts',
  'packages/vike/src/shared-server-client/getPageFiles/getAllPageIdFiles.ts',
  'packages/vike/src/shared-server-client/getPageFiles/getPageFileObject.ts',
  'packages/vike/src/shared-server-client/getPageFiles/parseVirtualFileExportsGlobalEntry.ts',
  'packages/vike/src/shared-server-client/getPublicProxy.ts',
  'packages/vike/src/shared-server-client/hooks/execHook.ts',
  'packages/vike/src/shared-server-client/hooks/getHook.ts',
  'packages/vike/src/shared-server-client/htmlElementIds.ts',
  'packages/vike/src/shared-server-client/misc/isServerSideError.ts',
  'packages/vike/src/shared-server-client/misc/pageContextInitIsPassedToClient.ts',
  'packages/vike/src/shared-server-client/modifyUrl.ts',
  'packages/vike/src/shared-server-client/modifyUrlSameOrigin.ts',
  'packages/vike/src/shared-server-client/NOT_SERIALIZABLE.ts',
  'packages/vike/src/shared-server-client/page-configs/assertPlusFileExport.ts',
  'packages/vike/src/shared-server-client/page-configs/findPageConfig.ts',
  'packages/vike/src/shared-server-client/page-configs/getConfigDefinedAt.ts',
  'packages/vike/src/shared-server-client/page-configs/getConfigValueBuildTime.ts',
  'packages/vike/src/shared-server-client/page-configs/getConfigValueRuntime.ts',
  'packages/vike/src/shared-server-client/page-configs/getConfigValueTyped.ts',
  'packages/vike/src/shared-server-client/page-configs/getExportPath.ts',
  'packages/vike/src/shared-server-client/page-configs/helpers.ts',
  'packages/vike/src/shared-server-client/page-configs/loadAndParseVirtualFilePageEntry.ts',
  'packages/vike/src/shared-server-client/page-configs/resolveVikeConfigPublic.ts',
  'packages/vike/src/shared-server-client/page-configs/serialize/assertPageConfigsSerialized.ts',
  'packages/vike/src/shared-server-client/page-configs/serialize/PageConfigSerialized.ts',
  'packages/vike/src/shared-server-client/page-configs/serialize/parsePageConfigsSerialized.ts',
  'packages/vike/src/shared-server-client/page-configs/serialize/serializeConfigValues.ts',
  'packages/vike/src/shared-server-client/RenderErrorPage.ts',
  'packages/vike/src/shared-server-client/route/abort.ts',
  'packages/vike/src/shared-server-client/route/deduceRouteStringFromFilesystemPath.ts',
  'packages/vike/src/shared-server-client/route/execHookGuard.ts',
  'packages/vike/src/shared-server-client/route/execHookOnBeforeRoute.ts',
  'packages/vike/src/shared-server-client/route/index.ts',
  'packages/vike/src/shared-server-client/route/loadPageRoutes.ts',
  'packages/vike/src/shared-server-client/route/noRouteMatch.ts',
  'packages/vike/src/shared-server-client/route/resolvePrecedence.ts',
  'packages/vike/src/shared-server-client/route/resolveRoute.ts',
  'packages/vike/src/shared-server-client/route/resolveRouteFunction.ts',
  'packages/vike/src/shared-server-client/route/resolveRouteString.ts',
  'packages/vike/src/shared-server-client/route/resolveUrlPathname.ts',
  'packages/vike/src/shared-server-client/route/routing.ts',
  'packages/vike/src/shared-server-node/api-context.ts',
  'packages/vike/src/shared-server-node/assertV1Design.ts',
  'packages/vike/src/shared-server-node/extractAssetsQuery.ts',
  'packages/vike/src/shared-server-node/getFileSuffixes.ts',
  'packages/vike/src/shared-server-node/getVikeConfigError.ts',
  'packages/vike/src/shared-server-node/prependEntriesDir.ts',
  'packages/vike/src/shared-server-node/resolveBase.ts',
  'packages/vike/src/shared-server-node/virtualFileId.ts',
  'packages/vike/src/types/Config.ts',
  'packages/vike/src/types/Config/ConfigResolved.ts',
  'packages/vike/src/types/defineConfig.ts',
  'packages/vike/src/types/FilePath.ts',
  'packages/vike/src/types/GlobalContext.ts',
  'packages/vike/src/types/index-dreprecated.ts',
  'packages/vike/src/types/index.ts',
  'packages/vike/src/types/PageConfig.ts',
  'packages/vike/src/types/PageContext.ts',
  'packages/vike/src/types/VikeGlobalInternal.ts',
  'packages/vike/src/types/VikeNamespace.ts',
  'packages/vike/src/types/ViteManifest.ts',
  'packages/vike/src/utils/assert.ts',
  'packages/vike/src/utils/assertIsBrowser.ts',
  'packages/vike/src/utils/assertIsNotBrowser.ts',
  'packages/vike/src/utils/assertKeys.ts',
  'packages/vike/src/utils/assertNodeVersion.ts',
  'packages/vike/src/utils/assertRoutingType.ts',
  'packages/vike/src/utils/assertSetup.ts',
  'packages/vike/src/utils/assertSingleInstance.ts',
  'packages/vike/src/utils/assertVersion.ts',
  'packages/vike/src/utils/assertViteVersion.ts',
  'packages/vike/src/utils/capitalizeFirstLetter.ts',
  'packages/vike/src/utils/cast.ts',
  'packages/vike/src/utils/catchInfiniteLoop.ts',
  'packages/vike/src/utils/changeEnumerable.ts',
  'packages/vike/src/utils/checkType.ts',
  'packages/vike/src/utils/colorsClient.ts',
  'packages/vike/src/utils/colorsServer.ts',
  'packages/vike/src/utils/compareString.ts',
  'packages/vike/src/utils/createErrorWithCleanStackTrace.ts',
  'packages/vike/src/utils/debug.ts',
  'packages/vike/src/utils/debugGlob.ts',
  'packages/vike/src/utils/deepEqual.ts',
  'packages/vike/src/utils/escapeHtml.ts',
  'packages/vike/src/utils/escapeRegex.ts',
  'packages/vike/src/utils/findFile.ts',
  'packages/vike/src/utils/findPackageJson.ts',
  'packages/vike/src/utils/formatHintLog.ts',
  'packages/vike/src/utils/freezePartial.ts',
  'packages/vike/src/utils/genPromise.ts',
  'packages/vike/src/utils/getBetterError.ts',
  'packages/vike/src/utils/getFileExtension.ts',
  'packages/vike/src/utils/getGlobalObject.ts',
  'packages/vike/src/utils/getMostSimilar.ts',
  'packages/vike/src/utils/getPropAccessNotation.ts',
  'packages/vike/src/utils/getRandomId.ts',
  'packages/vike/src/utils/getTerminalWidth.ts',
  'packages/vike/src/utils/getValuePrintable.ts',
  'packages/vike/src/utils/getViteRPC.ts',
  'packages/vike/src/utils/hasProp.ts',
  'packages/vike/src/utils/humanizeTime.ts',
  'packages/vike/src/utils/includes.ts',
  'packages/vike/src/utils/injectRollupInputs.ts',
  'packages/vike/src/utils/installUncaughtErrorHandlers.ts',
  'packages/vike/src/utils/isArray.ts',
  'packages/vike/src/utils/isArrayOfStrings.ts',
  'packages/vike/src/utils/isBrowser.ts',
  'packages/vike/src/utils/isCallable.ts',
  'packages/vike/src/utils/isDev.ts',
  'packages/vike/src/utils/isDocker.ts',
  'packages/vike/src/utils/isEqualStringList.ts',
  'packages/vike/src/utils/isExactlyOneTruthy.ts',
  'packages/vike/src/utils/isFilePathAbsoluteFilesystem.ts',
  'packages/vike/src/utils/isHtml.ts',
  'packages/vike/src/utils/isImportPath.ts',
  'packages/vike/src/utils/isNodeJS.ts',
  'packages/vike/src/utils/isNonRunnableDevProcess.ts',
  'packages/vike/src/utils/isNullish.ts',
  'packages/vike/src/utils/isObject.ts',
  'packages/vike/src/utils/isObjectOfStrings.ts',
  'packages/vike/src/utils/isObjectWithKeys.ts',
  'packages/vike/src/utils/isPlainObject.ts',
  'packages/vike/src/utils/isPromise.ts',
  'packages/vike/src/utils/isPropertyGetter.ts',
  'packages/vike/src/utils/isReact.ts',
  'packages/vike/src/utils/isRunnableDevEnvironment.ts',
  'packages/vike/src/utils/isSameErrorMessage.ts',
  'packages/vike/src/utils/isScriptFile.ts',
  'packages/vike/src/utils/isVikeReactApp.ts',
  'packages/vike/src/utils/isVitest.ts',
  'packages/vike/src/utils/joinEnglish.ts',
  'packages/vike/src/utils/normalizeHeaders.ts',
  'packages/vike/src/utils/objectAssign.ts',
  'packages/vike/src/utils/objectAssignSafe.ts',
  'packages/vike/src/utils/objectDefineProperty.ts',
  'packages/vike/src/utils/objectEntries.ts',
  'packages/vike/src/utils/objectEntriesForEach.ts',
  'packages/vike/src/utils/objectFilter.ts',
  'packages/vike/src/utils/objectFromEntries.ts',
  'packages/vike/src/utils/objectKeys.ts',
  'packages/vike/src/utils/objectReplace.ts',
  'packages/vike/src/utils/onPageVisibilityChange.ts',
  'packages/vike/src/utils/parseNpmPackage.ts',
  'packages/vike/src/utils/parseUrl-extras.ts',
  'packages/vike/src/utils/parseUrl.ts',
  'packages/vike/src/utils/path.ts',
  'packages/vike/src/utils/pick.ts',
  'packages/vike/src/utils/pLimit.ts',
  'packages/vike/src/utils/preservePropertyGetters.ts',
  'packages/vike/src/utils/PROJECT_VERSION.ts',
  'packages/vike/src/utils/PromiseType.ts',
  'packages/vike/src/utils/redirectHard.ts',
  'packages/vike/src/utils/removeEmptyLines.ts',
  'packages/vike/src/utils/removeFileExtension.ts',
  'packages/vike/src/utils/requireResolve.ts',
  'packages/vike/src/utils/rollupSourceMap.ts',
  'packages/vike/src/utils/shallowClone.ts',
  'packages/vike/src/utils/sleep.ts',
  'packages/vike/src/utils/slice.ts',
  'packages/vike/src/utils/sorter.ts',
  'packages/vike/src/utils/stringifyStringArray.ts',
  'packages/vike/src/utils/styleFileRE.ts',
  'packages/vike/src/utils/throttle.ts',
  'packages/vike/src/utils/trackLogs.ts',
  'packages/vike/src/utils/trimWithAnsi.ts',
  'packages/vike/src/utils/truncateString.ts',
  'packages/vike/src/utils/unique.ts',
  'packages/vike/src/utils/updateType.ts',
  'packages/vike/src/utils/urlToFile.ts',
  'packages/vike/src/utils/virtualFileId.ts',
]

function main() {
  // Find all .ts files in packages/vike/src, excluding test files and assertEnv files
  const findOutput = execSync(
    'find packages/vike/src -name "*.ts" -type f ! -name "*.spec.ts" ! -name "*.test.ts" ! -name "assertEnv*.ts"',
    { encoding: 'utf-8' },
  )
  const tsFiles = findOutput
    .trim()
    .split('\n')
    .filter((line) => line.length > 0)

  const filesWithoutImport = []
  const violations = []

  for (const file of tsFiles) {
    const content = fs.readFileSync(file, 'utf-8')

    // Check if file imports assertEnv*.ts
    const hasAssertEnvImport = /import\s+.*['"].*assertEnv.*\.js['"]/.test(content)

    if (!hasAssertEnvImport) {
      filesWithoutImport.push(file)

      // Check if this file is whitelisted
      if (!WHITELIST.includes(file)) {
        violations.push(file)
      }
    }
  }

  // Report results
  console.log(`✓ Total .ts files checked: ${tsFiles.length}`)
  console.log(`✓ Files with assertEnv import: ${tsFiles.length - filesWithoutImport.length}`)
  console.log(`✓ Files without assertEnv import: ${filesWithoutImport.length}`)
  console.log(`✓ Whitelisted files: ${WHITELIST.length}`)

  if (violations.length > 0) {
    console.error(
      `\n❌ ERROR: ${violations.length} file(s) are missing assertEnv*.ts import and are not whitelisted:\n`,
    )
    violations.forEach((file) => {
      console.error(`  - ${file}`)
    })
    console.error(
      '\nPlease either:\n1. Add the appropriate assertEnv*.ts import to these files, or\n2. Add them to the WHITELIST in scripts/lint-assertenv.js\n',
    )
    process.exit(1)
  }

  console.log('\n✅ All .ts files either have assertEnv*.ts import or are whitelisted.')
}

try {
  main()
} catch (err) {
  console.error('Error running lint-assertenv:', err)
  process.exit(1)
}
