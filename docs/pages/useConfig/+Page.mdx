import { Link, Contribution } from '@brillout/docpress'
import { ProvidedBy } from '../../components'

Environment: server, client.

<ProvidedBy noCustomGuide={true}>`useConfig()`</ProvidedBy>

The `useConfig()` hook enables you to define <Link href="/settings#html-shell" doNotInferSectionTitle>these settings</Link> inside UI components and Vike hooks.

## Vike hooks

You can use `useConfig()` inside any Vike hook, most notably <Link href="/data">`+data`</Link>.

> Normally, hooks can only be used inside UI components. But this one is different — it can also be used inside Vike hooks. We call it a *universal hook* (`useConfig()` is the only universal hook so far).

```jsx
// pages/movies/+data.jsx

export { data }

import { useConfig } from 'vike-react/useConfig' // or vike-vue / vike-solid

async function data(pageContext) {
  const config = useConfig()
  const response = await fetch('https://star-wars.brillout.com/api/films.json')
  let { movies } = await response.json()
  config({
    title: `${movies.length} Star Wars Movies`
    Head: <meta name="description" content={`List of all ${movies.length} Star Wars movies.`} />
  })
  return { movies }
}
```

> Make sure to call `useConfig()` before any `await`:
> ```js
> export async function data(pageContext) {
>   const response = await fetch('https://star-wars.brillout.com/api/films.json')
>   // ❌ Doesn't work: useConfig() has to be called before `await fetch()`
>   const config = useConfig()
> }
> ```


## UI components

```jsx
import { useConfig } from 'vike-react/useConfig' // or vike-vue / vike-solid

function Movies() {
  // Fetch data
  const data = useSomeDataFetchingTool()

  // Set <head> tags
  const config = useConfig()
  config({
    title: data.title,
    Head: <meta property="og:image" content={data.previewImage} />
  })

  // Render UI
  return (
    <ul>
      { data.movies.map(({ title }) => (
        <li>{title}</li>
      )) }
    </ul>
  )
}
```

## `<Config>` & `<Head>`

For a more declarative usage, you can use `<Config>` and `<Head>` instead of `useConfig()`:

```jsx
import { Config } from 'vike-react/Config' // or vike-vue / vike-solid
import { Head } from 'vike-react/Head' // or vike-vue / vike-solid

function Movies() {
  // Fetch data
  const data = useSomeDataFetchingTool()

  // Render UI and <head> tags
  return (
    <Config title={data.title} />
    <Head>
      <meta property="og:image" content={data.previewImage} />
    </Head>
    <ul>{
      data.movies.map(({ title }) => (
        <li>{title}</li>
      ))
    }</ul>
  )
}
```

> The `<Config>` and `<Head>` components are only `useConfig()` wrappers: the result is the same — they are just for convenience.
>
> For example, the following doesn't make any difference:
> ```js
> function Movies() {
>   const data = useSomeDataFetchingTool()
>
>   useConfig({ // [!code ++]
>     title: data.title, // [!code ++]
>     Head: <meta property="og:image" content={data.previewImage} /> // [!code ++]
>   }) // [!code ++]
>
>   return (
>     <Config title={data.title} /> // [!code --]
>     <Head>// [!code --]
>       <meta property="og:image" content={data.previewImage} />// [!code --]
>     </Head>// [!code --]
>     {/* ... */}
>   )
> }
> ```
>
> Likewise, `<Head><something/></Head>` and `<Config Head={<something/>}/>` are equivalent as well.

> Unlike other frameworks, we didn't implement a `<Title>` component because its value must be a string — `<Title><b>Hello</b> World</Title>` doesn't make sense.


## Example: React Query

The `useConfig()` hook is especially useful when using extensions such as
[`vike-react-query`](https://github.com/vikejs/vike-react/tree/main/packages/vike-react-query#readme)
and
[`vike-react-apollo`](https://github.com/vikejs/vike-react/tree/main/packages/vike-react-apollo#readme)
that enable components to fetch data.
It enables your components to use the data they fetch to set `<head>` tags.

```jsx
import { useConfig } from 'vike-react/useConfig'
import { useSuspenseQuery } from '@tanstack/react-query'

function Movies() {
  // Fetch data
  const query = useSuspenseQuery({
    queryKey: ['movies'],
    queryFn: () => fetch('https://star-wars.brillout.com/api/films.json')
  })
  const movies = query.data

  // Set <head> tags
  const config = useConfig()
  config({
    title: `${movies.length} Star Wars Movies` // <title>
    Head: <meta name="description" content={`List of all ${movies.length} Star Wars movies.`} />
  })

  // Render UI
  return (
    <ul>{
      movies.map(({ title }) => (
        <li>{title}</li>
      ))
    }</ul>
  )
}
```

Or with `<Config>` and `<Head>`:

```jsx
import { Config } from 'vike-react/Config'
import { Head } from 'vike-react/Head'
import { useSuspenseQuery } from '@tanstack/react-query'

function Movies() {
  // Fetch data
  const query = useSuspenseQuery({
    queryKey: ['movies'],
    queryFn: () => fetch('https://star-wars.brillout.com/api/films.json')
  })
  const movies = query.data

  // Render UI and <head> tags
  return (
    <Config title={`${movies.length} Star Wars Movies`} />
    <Head>
      <meta name="description" content={`List of all ${movies.length} Star Wars movies.`} />
    </Head>
    <ul>{
      movies.map(({ title }) => (
        <li>{title}</li>
      ))
    }</ul>
  )
}
```
