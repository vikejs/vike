import { Link } from '@brillout/docpress'
import { TextEnv, TextEnv2 } from './TextEnv'
import { UiFrameworkExtension, FrameworkToggle, EnvironmentToggle } from '../../components'

List of built-in hooks. (You can <Link href="/meta">create your own</Link>.)

See also: <Link href="/settings" />.

## Basics

- [**`data()`**](/data): <TextEnv>server (configurable)</TextEnv> Called before the page is rendered, for fetching data.
- [**`guard()`**](/guard): <TextEnv>server (configurable)</TextEnv> Protect pages from unprivileged access.
- [**`onHydrationEnd()`**](/onHydrationEnd): <TextEnv>client</TextEnv> Called after the page is <Link href="/hydration">hydrated</Link>.
- [**`onPageTransitionStart()`**](/onPageTransitionStart): <TextEnv>client</TextEnv> Called upon page navigation, before the new page starts rendering.
- [**`onPageTransitionEnd()`**](/onPageTransitionEnd): <TextEnv>client</TextEnv> Called upon page navigation, after the new page has finished rendering.
- [**`onCreatePageContext()`**](/onCreatePageContext): <TextEnv>server & client</TextEnv> Hook called when a <Link href="/pageContext">`pageContext` object</Link> is created.
- [**`onCreateGlobalContext()`**](/onCreateGlobalContext): <TextEnv>server & client</TextEnv> Hook called when the <Link href="/globalContext">`globalContext` object</Link> is created.

**Pre-rendering**

- [**`onBeforePrerenderStart()`**](/onBeforePrerenderStart): <TextEnv>server</TextEnv> Called before the whole <Link href="/pre-rendering">Pre-rendering</Link> process starts.
- [**`onPrerenderStart()`**](/onPrerenderStart): <TextEnv>server</TextEnv> Global hook called when <Link href="/pre-rendering">Pre-rendering</Link> starts.

## Framework-specific hooks

<FrameworkToggle>
  {(framework) => {
    if (framework === 'react') {
      return (
        <div>
          <h4>React hooks (vike-react)</h4>
          <ul>
            <li>
              <strong>
                <Link href="/onBeforeRenderHtml">`onBeforeRenderHtml()`</Link>
              </strong>
              : <TextEnv>server</TextEnv> Called at the beginning of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onAfterRenderHtml">`onAfterRenderHtml()`</Link>
              </strong>
              : <TextEnv>server</TextEnv> Called at the end of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onBeforeRenderClient">`onBeforeRenderClient()`</Link>
              </strong>
              : <TextEnv>client</TextEnv> Called at the beginning of{' '}
              <Link href="/onRenderClient">`onRenderClient()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onAfterRenderClient">`onAfterRenderClient()`</Link>
              </strong>
              : <TextEnv>client</TextEnv> Called at the end of <Link href="/onRenderClient">`onRenderClient()`</Link>.
            </li>
          </ul>
          <p>React-specific functionality is primarily handled through these hooks and the core Vike hooks.</p>
        </div>
      )
    } else if (framework === 'vue') {
      return (
        <div>
          <h4>Vue hooks (vike-vue)</h4>
          <ul>
            <li>
              <strong>
                <Link href="/onCreateApp">`onCreateApp()`</Link>
              </strong>
              : <TextEnv>server & client</TextEnv> Called after creating Vue's `app` instance.
            </li>
            <li>
              <strong>
                <Link href="/onBeforeRenderHtml">`onBeforeRenderHtml()`</Link>
              </strong>
              : <TextEnv>server</TextEnv> Called at the beginning of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onAfterRenderHtml">`onAfterRenderHtml()`</Link>
              </strong>
              : <TextEnv>server</TextEnv> Called at the end of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onBeforeRenderClient">`onBeforeRenderClient()`</Link>
              </strong>
              : <TextEnv>client</TextEnv> Called at the beginning of{' '}
              <Link href="/onRenderClient">`onRenderClient()`</Link>.
            </li>
            <li>
              <strong>
                <Link href="/onAfterRenderClient">`onAfterRenderClient()`</Link>
              </strong>
              : <TextEnv>client</TextEnv> Called at the end of <Link href="/onRenderClient">`onRenderClient()`</Link>.
            </li>
          </ul>
        </div>
      )
    } else {
      return (
        <div>
          <h4>Solid hooks (vike-solid)</h4>
          <ul>
            <li>
              <strong>
                <Link href="/onAfterRenderClient">`onAfterRenderClient()`</Link>
              </strong>
              : <TextEnv>client</TextEnv> Called at the end of <Link href="/onRenderClient">`onRenderClient()`</Link>.
            </li>
          </ul>
          <p>
            Solid-specific functionality is primarily handled through the core hooks and this additional client-side
            hook.
          </p>
        </div>
      )
    }
  }}
</FrameworkToggle>

## Data hook environments

<EnvironmentToggle>
  {(environment) => {
    if (environment === 'server') {
      return (
        <div>
          <h4>Server-only data fetching</h4>
          <p>
            Use <code>+data.server.js</code> to fetch data only on the server-side:
          </p>
          <pre>
            <code>{`// /pages/movies/+data.server.js
export async function data() {
  const response = await fetch('https://api.example.com/movies')
  const movies = await response.json()
  return { movies }
}`}</code>
          </pre>
          <p>
            <strong>Benefits:</strong>
          </p>
          <ul>
            <li>Direct database access</li>
            <li>Better security (API keys not exposed to client)</li>
            <li>Faster initial page load</li>
          </ul>
        </div>
      )
    } else if (environment === 'client') {
      return (
        <div>
          <h4>Client-only data fetching</h4>
          <p>
            Use <code>+data.client.js</code> to fetch data only on the client-side:
          </p>
          <pre>
            <code>{`// /pages/movies/+data.client.js
export async function data() {
  const response = await fetch('/api/movies')
  const movies = await response.json()
  return { movies }
}`}</code>
          </pre>
          <p>
            <strong>Benefits:</strong>
          </p>
          <ul>
            <li>Real-time data updates</li>
            <li>Reduced server load</li>
            <li>Better for dynamic content</li>
          </ul>
        </div>
      )
    } else {
      return (
        <div>
          <h4>Shared data fetching (isomorphic)</h4>
          <p>
            Use <code>+data.js</code> to fetch data on both server and client:
          </p>
          <pre>
            <code>{`// /pages/movies/+data.js
export async function data() {
  const response = await fetch('https://api.example.com/movies')
  const movies = await response.json()
  return { movies }
}`}</code>
          </pre>
          <p>
            <strong>Benefits:</strong>
          </p>
          <ul>
            <li>Same code runs everywhere</li>
            <li>Automatic SSR support</li>
            <li>Consistent data fetching logic</li>
          </ul>
        </div>
      )
    }
  }}
</EnvironmentToggle>

## Advanced

> Most users don't need to know about these hooks.

- [**`onData()`**](/onData): <TextEnv>server & client</TextEnv> Called as soon as <Link href="/pageContext#data">`pageContext.data`</Link> is available.
- [**`onBeforeRender()`**](/onBeforeRender): <TextEnv>server (configurable)</TextEnv> Called before the page is rendered, lower-level and usually for advanced integrations with data fetching tools.
- [**`onRenderHtml()`**](/onRenderHtml): <TextEnv>server</TextEnv> Called when a page is rendered to HTML on the server-side.
- [**`onRenderClient()`**](/onRenderClient): <TextEnv>client</TextEnv> Called when a page is rendered on the client-side.
- [**`onBeforeRoute()`**](/onBeforeRoute): <TextEnv>server & client</TextEnv> Called before the URL is routed to a page.
- [**`onBeforeRenderClient()`**](/onBeforeRenderClient): <TextEnv>client</TextEnv> Called at the beginning of <Link href="/onRenderClient">`onRenderClient()`</Link>.
- [**`onAfterRenderClient()`**](/onAfterRenderClient): <TextEnv>client</TextEnv> Called at the end of <Link href="/onRenderClient">`onRenderClient()`</Link>.
- [**`onBeforeRenderHtml()`**](/onBeforeRenderHtml): <TextEnv>server</TextEnv> Called at the beginning of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.
- [**`onAfterRenderHtml()`**](/onAfterRenderHtml): <TextEnv>server</TextEnv> Called at the end of <Link href="/onRenderHtml">`onRenderHtml()`</Link>.

## Upcoming

Potentially upcoming hooks:

- [New hook `onLog()`](https://github.com/vikejs/vike/issues/1438)
- [New hook `onRenderContent()`: generate non-HTML files with arbitrary content](https://github.com/vikejs/vike/issues/1525)

## Lifecycle

> See also:
>
> - <Link href="/pageContext#lifecycle" />
> - <Link href="/globalContext#lifecycle" />

The order in which the hooks are called (the hook flow).

> The following doesn't contain the hooks of the Vike extensions <UiFrameworkExtension name /> such as <Link href="/onAfterRenderHtml">`onAfterRenderHtml()`</Link> or <Link href="/onAfterRenderClient">`onAfterRenderClient()`</Link>.

> The <Link href="/onCreateGlobalContext">`onCreateGlobalContext()` hook</Link> is called when the `globalContext` object is created, see <Link href="/globalContext#lifecycle" />.

### Default

If you didn't change the environment of `data()` nor `onBeforeRender()`:

**First render**

1. <TextEnv2>server</TextEnv2> <Link href="/renderPage">`renderPage()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onBeforeRoute">`onBeforeRoute()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/routing">Routing</Link>> The routing executes your <Link href="/route-function">
     Route Functions
   </Link> (of all your pages).
1. <TextEnv2>server</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/guard">`guard()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/data">`data()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onData">`onData()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onBeforeRender">`onBeforeRender()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onRenderHtml">`onRenderHtml()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onRenderClient">`onRenderClient()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onHydrationEnd">`onHydrationEnd()`</Link>

**Client-side navigation**

1. <TextEnv2>client</TextEnv2> <Link href="/onPageTransitionStart">`onPageTransitionStart()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onBeforeRoute">`onBeforeRoute()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/routing">Routing</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onBeforeRoute">`onBeforeRoute()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/routing">Routing</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>> The routing is executed
   twice: once for the client and once for the server.
1. <TextEnv2>server</TextEnv2> <Link href="/guard">`guard()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/data">`data()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onBeforeRender">`onBeforeRender()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onData">`onData()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onRenderClient">`onRenderClient()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onPageTransitionEnd">`onPageTransitionEnd()`</Link>

### Client-side only `data()`

If you <Link href="/data#environment">configured `data()`</Link> and <Link href="/onBeforeRender#environment">`onBeforeRender()` as well</Link> to run _only_ on the client-side:

**First render**

1. <TextEnv2>server</TextEnv2> <Link href="/renderPage">`renderPage()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onBeforeRoute">`onBeforeRoute()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/routing">Routing</Link>> The routing executes your <Link href="/route-function">
     Route Functions
   </Link> (of all your pages).
1. <TextEnv2>server</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>server</TextEnv2> <Link href="/onRenderHtml">`onRenderHtml()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/guard">`guard()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/data">`data()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onData">`onData()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onBeforeRender">`onBeforeRender()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onRenderClient">`onRenderClient()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onHydrationEnd">`onHydrationEnd()`</Link>

**Client-side navigation**

1. <TextEnv2>client</TextEnv2> <Link href="/onPageTransitionStart">`onPageTransitionStart()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onBeforeRoute">`onBeforeRoute()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/routing">Routing</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onCreatePageContext">`onCreatePageContext()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/guard">`guard()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/data">`data()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onData">`onData()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onBeforeRender">`onBeforeRender()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onRenderClient">`onRenderClient()`</Link>
1. <TextEnv2>client</TextEnv2> <Link href="/onPageTransitionEnd">`onPageTransitionEnd()`</Link>

## See also

- <Link href="/settings" />
- <Link href="/config" />
