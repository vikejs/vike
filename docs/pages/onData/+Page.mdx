import { Link } from '@brillout/docpress'
import { ConfigSpec } from '../../components'

<ConfigSpec
  env="client, server"
  cumulative
/>

Hook called after the data fetched via <Link href="/data">`+data`</Link> is available.

```ts
// pages/movies/+onData.ts
// Environment: client, server

export { onData }

import type { PageContext } from 'vike/types'
import type { Data } from './+data'

function onData(pageContext: PageContext & { data: Data }) {
  // Do something with pageContext.data
  console.log(pageContext.data)
}
```

```ts
// pages/movies/+data.ts
// Environment: server

export { data }
export type Data = Awaited<ReturnType<typeof data>>

import type { PageContextServer } from 'vike/types'

async function data(pageContext: PageContextServer) {
  const data = await fetchSomeData()
  return data
}
```

The lifecycle of the `+onData` hook differs from <Link href="/data#environment">that of `+data`</Link>:
 - Upon <Link href="/ssr">SSR</Link> (or <Link href="/pre-rendering">pre-rendering</Link>), `+onData` is called on the server-side right after `+data`.
 - Upon <Link href="/client-routing">client-side navigation</Link>, `+onData` is called on the client-side right after `pageContext.data` is received from the server.

It's typically used for populating the initial state of <Link href="/store">a store</Link> with data fetched via `+data`.

> To prevent <Link href="/hydration-mismatch">hydration mismatches</Link>, the client must use the exact same initial state as the server during SSR.
>
> The `+onData` hook enables you to set the store's initial state on the server during SSR (while the initial state is automatically sent to the client), and on the client upon client-side navigation.


It's <Link href="/config#inheritance">cumulative</Link>, so you can define multiple `+onData`:

```yaml
pages/+onData.ts # Global hook called after every +data
pages/movies/+onData.ts
pages/movies/+data.ts # Both +onData hooks are called after this +data hook
```


## See also

- <Link href="/store" />
- <Link href="/data" />
- <Link href="/hooks" />
