import { Link, RepoLink } from '@brillout/docpress'
import { ConfigSpec } from '../../components'

<ConfigSpec
  env="client, server"
  cumulative
  global
/>

Hook called when the <Link href="/globalContext">`globalContext` object</Link> is created.

```ts
// pages/+onCreateGlobalContext.ts
// Environment: server & client

import type { GlobalContext } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContext) {
  // Server or client — globalContext was just created
}
```
```ts
// pages/+onCreateGlobalContext.server.ts
// Environment: server

import type { GlobalContextServer } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextServer) {
  // Server only — globalContext was just created
}
```
```ts
// pages/+onCreateGlobalContext.client.ts
// Environment: client

import type { GlobalContextClient } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextClient) {
  // Client only — globalContext was just created
}
```
> See also:
> - <Link href="/file-env" />

> You can also define two separate hooks (`+onCreateGlobalContext.server.js` and `+onCreateGlobalContext.client.js`) instead of a single `+onCreateGlobalContext.js` hook.

See <Link href="/globalContext#lifecycle" /> to understand when `onCreateGlobalContext()` is called.

See also:
- <Link href="/onCreatePageContext" />


## Use case: initialization

Initializing a `globalContext` property:

```ts
// pages/+onCreateGlobalContext.client.ts
// Environment: client

import type { GlobalContextClient } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextClient) {
  globalContext.someInstance = new Instance()
}

declare global {
  namespace Vike {
    interface GlobalContextClient {
      someInstance: Instance
    }
  }
}
```


## Use case: global data

Fetching global data that is accessible to all pages:

```ts
// pages/+onCreateGlobalContext.server.ts
// Environment: server

import type { GlobalContextServer } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextServer) {
  globalContext.someData = await fetchSomeData()
}

declare global {
  namespace Vike {
    // Extend GlobalContext instead of GlobalContextServer because someData is passed to client
    interface GlobalContext {
      someData: Awaited<ReturnType<typeof fetchSomeData>>
    }
  }
}
```

```ts
// pages/+config.ts

import type { Config } from 'vike/types'

export default {
  passToClient: ['someData']
} satisfies Config
```

> <Link href="/passToClient" noBreadcrumb /> also works for `globalContext`.


## Use case: authentication

Client-side authentication:

```ts
// pages/+onCreateGlobalContext.client.ts
// Environment: client

import type { GlobalContextClient } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextClient) {
  globalContext.loggedInUser = retrieveUserFromCookie()
}

declare global {
  namespace Vike {
    interface GlobalContextClient {
      loggedInUser: ReturnType<typeof retrieveUserFromCookie>
    }
  }
}
```

> See also: <Link href="/auth#ssg" doNotInferSectionTitle />.


## Use case: store

Initializing a <Link href="/store">store</Link> on the client-side:

```ts
// pages/+onCreateGlobalContext.client.ts
// Environment: client

import { Store } from 'some-state-management-library'
import type { GlobalContextClient } from 'vike/types'

export async function onCreateGlobalContext(globalContext: GlobalContextClient) {
  globalContext.store = new Store()
}

declare global {
  namespace Vike {
    interface GlobalContextClient {
      store: Store
    }
  }
}
```

On the server-side, the store is typically initialized by using a <Link href="/onCreatePageContext" noBreadcrumb />.

See also:
 - <Link href="/onCreatePageContext#use-case-store" doNotInferSectionTitle />
 - <Link href="/store#manual-integration" />


## See also

- <Link href="/globalContext" />
- <Link href="/globalContext#lifecycle" />
- <Link href="/getGlobalContext" />
- <Link href="/onCreatePageContext" />
- <Link href="/hooks" />
- <Link href="/hooks#lifecycle" />
