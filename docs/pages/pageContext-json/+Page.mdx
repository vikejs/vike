import { Link } from '@brillout/docpress'

Upon <Link href="/client-routing">client-side navigation</Link>,
Vike retrieves certain server-side `pageContext` properties by sending an HTTP request to your server.

```shell
# Retrieve data fetched on the server-side
HTTP GET /product/42/index.pageContext.json
```

Most notably, the returned `pageContext` object includes data fetched via <Link href="/data#environment">`+data` on the server-side</Link>.

> If the server-side doesn't fetch data, then the client-side skips making a `pageContext.json` request, see <Link href="#avoid-pagecontext-json-requests" />.

> See also: <Link href="/pageContext#lifecycle" />.


## Example

```ts
// /pages/star-wars/+data.server.ts

export { data }
export type Data = Awaited<ReturnType<typeof data>>

// This data() hook is always called on the server-side. But, upon page navigation, the data
// needs to be available on the client-side thus Vike makes a /star-wars/index.pageContext.json
// request in order to pass the data from the server to the client.
async function data() {
  const response = await fetch('https://star-wars.brillout.com/api/films.json')
  const movies = await response.json()
  return { movies }
}
```
The request `/star-wars/index.pageContext.json` returns the data fetched by the `data()` hook.

```bash
$ curl /star-wars/index.pageContext.json
{
  "data": {
    "movies": [
      {
        "title": "A New Hope",
        "release_date": "1977-05-25"
      },
      {
        "title": "The Empire Strikes Back",
        "release_date": "1980-05-17"
      },
      {
        "title": "Return of the Jedi",
        "release_date": "1983-05-25"
      }
    ]
  }
}
```

## Avoid `pageContext.json` requests

To minimize server requests, you may want Vike to stop making `pageContext.json` requests.

> For example, if your data comes from another server, you typically don't want an unnecessary detour through your JavaScript/SSR server.

To stop Vike from requesting `pageContext.json`, do the following:
- Make sure the page doesn't use any server-only `data()`, `onCreatePageContext()`, or `onBeforeRender()` hook.
  > See also:
  > - <Link href="/data#environment" />
  > - <Link href="/onBeforeRender#environment" />
  > - <Link href="/onCreatePageContext" />
  > - <Link href="/pageContext#lifecycle" />
  > <p/> {/* [MDX-workaround-list-at-end-of-note] */ }

  > Also make sure your Vike extensions don't define such server-only hook.
  >
  > For example, [`vike-vue-pinia@0.2.3` defines `+onCreatePageContext.server.js`](https://github.com/vikejs/vike-vue/blob/c2146ea3fd187a58cad26f7025c3c2339bc4229b/packages/vike-vue-pinia/integration/onCreatePageContext.server.ts)
  > and [`vike-react-redux@0.1.1` as well](https://github.com/vikejs/vike-react/blob/20942f6e2a392c56767657d5dd66060a0a8a34ae/packages/vike-react-redux/onCreatePageContext.server.ts)
  > â€” since both extensions are tiny, you can consider <Link href="/eject">ejecting</Link> them.
- If you have a <Link href="/server-integration">custom server integration</Link> (i.e. you don't use <Link href="/vike-photon">`vike-photon`</Link>), make sure the `pageContextInit` you pass to <Link href="/renderPage">`renderPage()`</Link> doesn't contain a property included in <Link href="/passToClient">`passToClient`</Link>.
  ```ts
  // Vike server middleware
  async (req: Request, res: Response) => {
    const pageContextInit = {
      urlOriginal: req.originalUrl,
      // If passToClient contains 'user' then Vike makes a pageContext.json request
      // upon page navigation in order the retrieve the pageContextInit.user value.
      user: req.user
    }
    const pageContext = await renderPage(pageContextInit)
    return pageContext.httpResponse
  }
  ```

See also:
- [#2566 - New setting `.once.js` e.g. `+data.once.js`](https://github.com/vikejs/vike/issues/2566)
- [#2561 - New setting `requestPageContext: boolean`](https://github.com/vikejs/vike/issues/2561)


## See also

- <Link href="/passToClient" />
- <Link href="/pageContext#lifecycle" />
- <Link href="/data#environment" />
- <Link href="/onBeforeRender#environment" />
