import { RepoLink, Link, FileAdded } from '@brillout/docpress'
import { Example, UseScaffolder } from '../../components'
import { Tab, Tabs, TabList, TabPanel } from 'react-tabs'
import '../../components/tabs.css'
import Examples from './Examples.mdx'

We recommend using `vike-cloudflare` to deploy your app to [Cloudflare](https://www.cloudflare.com).

{/* TO-DO/eventually: re-apply commit about Cloudflare Pages deprecation https://github.com/vikejs/vike/commit/f36a9709809339106ed061b3d0f41383ba17964b */}
{/* TO-DO/eventually: remove `cross-env NODE_ENV=production wrangler` after https://github.com/cloudflare/workers-sdk/issues/7886 is resolved */}

> <UseScaffolder>`vike-cloudflare`</UseScaffolder>


## `vike-cloudflare`

Version history: [`CHANGELOG.md`](https://github.com/vikejs/vike-cloudflare/blob/main/CHANGELOG.md)  
Examples: <Link href="/new">vike.dev/new</Link> and [`examples/`](https://github.com/vikejs/vike-cloudflare/tree/main/examples)  
Source code: [GitHub > `vikejs/vike-cloudflare`](https://github.com/vikejs/vike-cloudflare)  
npm package: [`vike-cloudflare`](https://www.npmjs.com/package/vike-cloudflare)  

You can use Vike with the `vike-cloudflare` extension for a zero-config Cloudflare deployment of your SSR or pre-rendered (aka SSG) app.

See:
 - <Link href="#with-server" /> if you use <Link href="/ssr">SSR</Link> (it requires a server).
 - <Link href="#without-server" /> if you <Link href="/pre-rendering">pre-render</Link> all your pages (you don't need a server then).

### With server

<Tabs>
  <TabList>
    <Tab>npm</Tab>
    <Tab>pnpm</Tab>
    <Tab>yarn</Tab>
  </TabList>
  <TabPanel>
    ```shell
    npm i vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
  <TabPanel>
    ```shell
    pnpm add vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
  <TabPanel>
    ```shell
    yarn add vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
</Tabs>

```ts
// pages/+config.ts

import type { Config } from 'vike/types'
import vikeCloudflare from 'vike-cloudflare/config'// [!code ++]

export default {
  extends: [vikeCloudflare],// [!code ++]
  server: {// [!code ++]
    entry: 'server/index.ts'// [!code ++]
  }// [!code ++]
} satisfies Config
```

> If you have `vike-server` installed then remove it (replace it with `vike-cloudflare`).

<Tabs>
  <TabList>
    <Tab>Hono</Tab>
    <Tab>Hattip</Tab>
  </TabList>

  <TabPanel>
    ```ts
    // server/index.ts

    import { Hono } from 'hono'
    import { apply } from 'vike-cloudflare/hono'// [!code ++]
    import { serve } from 'vike-cloudflare/hono/serve'// [!code ++]

    function startServer() {
      const app = new Hono()
      apply(app)// [!code ++]
      return serve(app, { port: 3000 })// [!code ++]
    }

    export default startServer()// [!code ++]
    ```
    > If you haven't already, set up a <Link href="/hono">Hono</Link> server and install the `hono` package.
  </TabPanel>
  <TabPanel>
    ```ts
    // server/index.ts

    import { createRouter } from '@hattip/router'
    import { apply } from 'vike-cloudflare/hattip'// [!code ++]
    import { serve } from 'vike-cloudflare/hattip/serve'// [!code ++]

    function startServer() {
      const router = createRouter()
      apply(router)// [!code ++]
      return serve(router, { port: 3000 })// [!code ++]
    }

    export default startServer()// [!code ++]
    ```
    > If you haven't already, set up a <Link href="/hattip">Hattip</Link> server and install the `@hattip/router` package.
  </TabPanel>
</Tabs>

> `vike-cloudflare` currently only supports Hono and Hattip — more servers are coming soon.

```json
// package.json

{
  "scripts": {
    "dev": "vike dev",
    "preview": "vike build && cross-env NODE_ENV=production wrangler pages dev",// [!code ++]
    "deploy": "vike build && cross-env NODE_ENV=production wrangler pages deploy"// [!code ++]
  }
}
```
<FileAdded>
```jsonc
// wrangler.jsonc

{
  "$schema": "node_modules/wrangler/config-schema.json",
  "compatibility_date": "2025-08-06",
  "name": "my-vike-cloudflare-app",
  "pages_build_output_dir": "./dist/cloudflare",
  // Only needed if your app (or one of your libraries) uses Node.js APIs
  "compatibility_flags": ["nodejs_compat"]
}
```
</FileAdded>

```bash
# .gitignore

.wrangler/ # [!code ++]
```

### Without server

<Tabs>
  <TabList>
    <Tab>npm</Tab>
    <Tab>pnpm</Tab>
    <Tab>yarn</Tab>
  </TabList>
  <TabPanel>
    ```shell
    npm i vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
  <TabPanel>
    ```shell
    pnpm add vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
  <TabPanel>
    ```shell
    yarn add vike-cloudflare wrangler cross-env
    ```
  </TabPanel>
</Tabs>

```ts
// pages/+config.ts

import type { Config } from 'vike/types'
import vikeCloudflare from 'vike-cloudflare/config'// [!code ++]

export default {
  prerender: true,
  extends: [vikeCloudflare]// [!code ++]
} satisfies Config
```

```jsonc
// package.json

{
  "scripts": {
    "dev": "vike dev",
    "preview": "vike build && cross-env NODE_ENV=production wrangler pages dev",// [!code ++]
    "deploy": "vike build && cross-env NODE_ENV=production wrangler pages deploy"// [!code ++]
  }
}
```
<FileAdded>
```jsonc
// wangler.jsonc

{
  "$schema": "node_modules/wrangler/config-schema.json",
  "compatibility_date": "2025-08-06",
  "name": "my-vike-cloudflare-app",
  "pages_build_output_dir": "./dist/cloudflare",
  "assets": {
    "directory": "./dist/cloudflare"
  }
}
```
</FileAdded>

```bash
# .gitignore

.wrangler/ # [!code ++]
```


## Cloudflare APIs

You can access Cloudflare's APIs (such as [D1](https://developers.cloudflare.com/d1/) and [KV](https://developers.cloudflare.com/kv/)):
- In development, by using [`getPlatformProxy()`](https://developers.cloudflare.com/workers/wrangler/api/#getplatformproxy)
- In production, by using [`import('cloudflare:workers')`](https://developers.cloudflare.com/workers/runtime-apis/bindings/#importing-env-as-a-global)

Using <Link href="/onCreateGlobalContext">`+onCreateGlobalContext.server`</Link>, you can make [Cloudflare's bindings](https://developers.cloudflare.com/workers/runtime-apis/bindings/) (the `env` object) available anywhere via <Link href="/globalContext#custom">`globalContext.cloudflare.env`</Link>.

```ts
// pages/+onCreateGlobalContext.server.ts

export { onCreateGlobalContext }

import type { GlobalContextServer } from 'vike/types'

async function onCreateGlobalContext(globalContext: GlobalContextServer) {
  let cloudflare: { env: Cloudflare.Env }
  if (import.meta.env.DEV) {
    const { getPlatformProxy } = await import('wrangler')
    cloudflare = (await getPlatformProxy()) as any
  } else {
    cloudflare = await import('cloudflare:workers')
  }
  globalContext.cloudflare = cloudflare
}

declare global {
  namespace Vike {
    interface GlobalContextServer {
      cloudflare: { env: Cloudflare.Env }
    }
  }
}
```

```ts
// vite.config.ts

import { defineConfig } from 'vite'

export default defineConfig({
  build: {
    rollupOptions: {
      external: ['cloudflare:workers']
    }
  }
})
```

> For an example of how to access [Cloudflare D1](https://developers.cloudflare.com/d1/) during development, see:
> <Tabs>
>   <TabList>
>     <Tab>npm</Tab>
>     <Tab>pnpm</Tab>
>     <Tab>yarn</Tab>
>   </TabList>
>   <TabPanel>
>     ```shell
>     npm create vike@latest --- --react --hono --drizzle --cloudflare
>     ```
>   </TabPanel>
>   <TabPanel>
>     ```shell
>     pnpm create vike@latest --react --hono --drizzle --cloudflare
>     ```
>   </TabPanel>
>   <TabPanel>
>     ```shell
>     yarn create vike@latest --react --hono --drizzle --cloudflare
>     ```
>   </TabPanel>
> </Tabs>
>
> Or go to <Link href="/new">vike.dev/new</Link> and select `Cloudflare` with an ORM.


## Extend 3MB limit

By default the bundle size of your worker cannot exceed 3MB, but you can request sizes of up to 100MB and beyond.
 - [Cloudflare Workers > Larger Scripts](https://www.cloudflare.com/larger-scripts-on-workers-early-access/)
 - [Cloudflare Workers > Limits > Worker Size](https://developers.cloudflare.com/workers/platform/limits/#worker-size)


## Manual integration

Instead of using `vike-cloudflare`, you can manually integrate your app with Cloudflare yourself.

### Cloudflare Pages

For a manual integration, we generally recommend using:
 - [Cloudflare Pages](https://developers.cloudflare.com/pages/) for static assets and <Link href="/pre-rendering">pre-rendered pages</Link>, and
 - [Pages Functions](https://developers.cloudflare.com/pages/platform/functions/) for <Link href="/ssr">SSR'd pages</Link>.

Examples:
 - <Example timestamp="2024.01" repo="travis-r6s/vike-cf-pages" /> - Advanced demo showcasing a lot of integrations such as REST, tRPC, GraphQL, Sentry, and Thumbprint.
 - <Example timestamp="2022.04" repo="Immortalin/vite-plugin-ssr-cloudflare-pages-demo" />
   > vite-plugin-ssr was the [previous name of Vike](https://vite-plugin-ssr.com/vike).

### Wrangler

You can also directly use [Cloudflare Workers](https://workers.cloudflare.com) instead of using Cloudflare Pages.

Cloudflare Workers requires your entire worker code to be bundled into a single file — you can use [Wrangler](https://github.com/cloudflare/workers-sdk) to achieve that (it uses [esbuild](https://esbuild.github.io/) under the hood).

> Cloudflare uses the term "worker code" to denote server code that is run on its edge infrastructure.

<Examples />

### Development

For a significantly faster development experience we recommend, whenever possible, using Vite's development server (or a server such as <Link href="/express">Express.js</Link> or <Link href="/hono">Hono</Link>) instead of Wrangler.

In other words:
 - Skip `wrangler` / Cloudflare Workers altogether while developing your app.
 - Use `wrangler dev` to preview your worker.
 - Use `wrangler publish` to deploy your worker to Cloudflare Workers.

<Examples />

#### Universal `fetch()`

When using Node.js(/Bun/Deno) for development and Cloudflare Workers for production, you may need a `fetch()` function that works in both environments.

You can define a fetch function at `pageContext.fetch` that works in all environments.
The trick is to add a different `fetch()` implementation to `pageContextInit` at <Link text={<code>renderPage(pageContextInit)</code>} href="/renderPage" />.

Example: <RepoLink path='/examples/cloudflare-workers-react-full#universal-fetch' />.

> Libraries such as `node-fetch` or `cross-fetch` typically don't work with Cloudflare Workers.


## See also

- <Link href="/cloudflare-pages" />
