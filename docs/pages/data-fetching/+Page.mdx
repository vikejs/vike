import { RepoLink, Link } from '@brillout/docpress'
import { UiFrameworkExtension } from '../../components'

To fetch and mutate data we generally recommend using the <Link href="#data">`data()`</Link> hook and <Link href="#rpc">RPC</Link>.

## `data()`

You can fetch data by using the <Link href="/data">Vike hook `data()`</Link> together with the <Link href="/useData">component hook `useData()`</Link>.

```js
// /pages/movies/@id/+data.js
// Environment: server

export { data }

import fetch from 'node-fetch'

async function data(pageContext) {
  const { id } = pageContext.routeParams
  const response = await fetch(`https://star-wars.brillout.com/api/films/${id}.json`)

  let movie = await response.json()
  // `movie` is serialized and passed to the client. Therefore, we pick only the
  // data the client needs in order to minimize what is sent over the network.
  movie = { title: movie.title, release_date: movie.release_date }

  // data() runs only on the server-side by default, we can therefore use ORM/SQL queries.
  /* With an ORM:
  const movies = await Movie.findAll({ select: ['title', 'release_date'] }) */
  /* With SQL:
  const movies = await sql.run('SELECT { title, release_date } FROM movies;') */

  return {
    movies
  }
}
```

> `pageContext` holds contextual information, see <Link href="/pageContext" />.

> The `@id` in the path `/pages/movie/@id/+data.js` denotes a route parameter which value is available at `pageContext.routeParams.id`, see <Link href="/routing" />.

```js
// SomeComponent.js
// Environment: server, client

import { useData } from 'vike-react/useData'
/* Or:
import { useData } from 'vike-vue/useData'
import { useData } from 'vike-solid/useData'
*/

  // Inside a UI component
  const data = useData()
  const { name, price } = data
```

> `useData()` is implemented by the <UiFrameworkExtension />. If you don't use <UiFrameworkExtension name noLink /> then see <Link href="/useData#without-vike-react-vue-solid" doNotInferSectionTitle />.

The `data()` hook can only be used for fetching the initial data of the page: for other use cases, such as data mutation and pagination data, use <Link href="#rpc">RPC</Link> instead.


## RPC

For data mutation, and for subsequent data fetching (such as pagination data), we recommend using an RPC tool, see <Link href="/RPC" />.

Alternatively, you can use API routes or GraphQL.

> We generally recommend RPC as it's usually simpler, more flexible and more performant.

**API routes**

A common alternative to RPC is to use API routes, <Link href="/api-routes" />.

**GraphQL**

For large teams, it may make more sense to use GraphQL instead of RPC.

With Vike, you can manually integrate GraphQL tools yourself, giving you complete control over integration:

- <Link href="/apollo-graphql" />
- <Link href="/relay" />
- <Link href="/urql" />

> In addtion to manual integration, [you will soon](https://github.com/vikejs/vike/issues/1715) have the option to use <Link href="/extensions">Vike Extensions</Link> for automatic integration.


## Global data

A common use case is to fetch global data that is needed by all pages. (For example i18n data.)

You can <Link href="/pageContext#custom">add your initial data to `pageContext` at `renderPage()`</Link>.

The <Link href="/pageContext">`pageContext` object is accessible from any Vike hook and any UI component</Link>, thus you can access your initialization data there as well.

If you use <Link href="/pre-rendering">pre-rendering</Link> then see the workaround described at [#962 - New hook `onBoot()`](https://github.com/vikejs/vike/issues/962).


## Store data

With Vike, you can manually integrate state management stores (Vuex/Redux...) yourself, giving you complete control over the integration. See:

- <Link href="/redux" />
- <Link href="/pinia" />

> In addtion to manual integration, [you will soon](https://github.com/vikejs/vike/issues/1715) have the option to use <Link href="/extensions">Vike Extensions</Link> for automatic integration.


## See also

- <Link href="/data" />
- <Link href="/useData" />
- <Link href="/RPC" />
- <Link href="/api-routes" />
