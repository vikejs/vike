import { Link } from '@brillout/docpress'
import { ConfigSpec } from '../../components'

<ConfigSpec
  env="client, server"
  cumulative
/>

Hook called when the <Link href="/pageContext">`pageContext` object</Link> is created.

```ts
// pages/+onCreatePageContext.ts
// Environment: server & client

import type { PageContext } from 'vike/types'

export async function onCreatePageContext(pageContext: PageContext) {
  // Server or client — pageContext was just created
}
```
```ts
// pages/+onCreatePageContext.server.ts
// Environment: server

import type { PageContextServer } from 'vike/types'

export async function onCreatePageContext(pageContext: PageContextServer) {
  // Server only — pageContext was just created
}
```
```ts
// pages/+onCreatePageContext.client.ts
// Environment: client

import type { PageContextClient } from 'vike/types'

export async function onCreatePageContext(pageContext: PageContextClient) {
  // Client only — pageContext was just created
}
```
> See also:
> - <Link href="/file-env" />

> You can also define two separate hooks (`+onCreatePageContext.server.js` and `+onCreatePageContext.client.js`) instead of a single `+onCreatePageContext.js` hook.

The `onCreatePageContext()` hook is called right after <Link href="/routing">routing</Link>, see:
- <Link href="/hooks#lifecycle" />
- <Link href="/pageContext#lifecycle" />

You can define multiple `onCreatePageContext()` hooks that apply to different groups of pages (or just a single page), see <Link href="/config#inheritance"/>.

See also:
- <Link href="/onCreateGlobalContext" />


## Use case: initialization

Initializing a `pageContext` property:

```ts
// pages/+onCreatePageContext.client.ts
// Environment: client

import type { PageContextClient } from 'vike/types'

export async function onCreatePageContext(pageContext: PageContextClient) {
  pageContext.someInstance = new Instance()
}

declare global {
  namespace Vike {
    interface PageContextClient {
      someInstance: Instance
    }
  }
}
```


## Use case: computed properties

Defining a `pageContext` property derived from multiple other properties:

```ts
// pages/+onCreatePageContext.server.ts
// Environment: server

import type { PageContextServer } from 'vike/types'

export async function onCreatePageContext(pageContext: PageContextServer) {
  pageContext.pageURLs =
    pageContext.globalContext.pages
    .map(page => ({
      url: page.route,
      isActive: page.route === pageContext.urlParsed.pathname
    }))
}

declare global {
  namespace Vike {
    // We extend PageContext instead of PageContextServer because pageURLs is passed to the client
    interface PageContext {
      pageURLs: { url: string, isActive: boolean }[]
    }
  }
}
```

> See also:
> - <Link href="/globalContext#pages">API > `globalContext.pages`</Link>
> - <Link href="/pageContext#urlParsed">API > `pageContext.urlParsed`</Link>
> - <Link href="/markdown#with-a-custom-setting-eager" doNotInferSectionTitle />


## Use case: store

Initializing a <Link href="/store">store</Link> on the server-side:

```ts
// pages/+onCreatePageContext.ssr.ts
// Environment: server

import { Store } from 'aweomse-store'
import type { PageContextServer } from 'vike/types'

// Note how we use `.ssr.js` instead of `.server.js` — this hook only runs during SSR,
// not during client-side navigation (`pageContext.json` requests).

export async function onCreatePageContext(pageContext: PageContextServer) {
  pageContext.store = new Store()
}

declare global {
  namespace Vike {
    interface PageContextServer {
      store: Store
    }
  }
}
```

On the client-side, the store is typically initialized by using a <Link href="/onCreateGlobalContext" noBreadcrumb/>.

See also:
 - <Link href="/onCreateGlobalContext#store" />
 - <Link href="/store#manual-integration" />


## See also

- <Link href="/pageContext" />
- <Link href="/pageContext#lifecycle" />
- <Link href="/onCreateGlobalContext" />
- <Link href="/hooks" />
- <Link href="/hooks#lifecycle" />
